/*!
 * 
 * SpreadJS Library 13.2.0
 * 
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Licensed under the SpreadJS Commercial License.
 * us.sales@grapecity.com
 * http://www.grapecity.com/en/licensing/grapecity/
 * 
 * 
 */
var GC="object"==typeof GC?GC:{};GC.Spread=GC.Spread||{},GC.Spread.Sheets=GC.Spread.Sheets||{},GC.Spread.Sheets.FormulaTextBox=function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){var d,e;if(1&b&&(a=c(a)),8&b)return a;if(4&b&&"object"==typeof a&&a&&a.__esModule)return a;if(d=Object.create(null),c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(e in a)c.d(d,e,function(b){return a[b]}.bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function b(){return a.default}:function b(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="/assets/",c(c.s="./dist/plugins/formulaTextbox/formulaTextBox.entry.js")}({"./dist/plugins/formulaTextbox/formulaTextBox.entry.js":function(a,b,c){"use strict";function d(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),d(c("./dist/plugins/formulaTextbox/formulatextbox.js")),d(c("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js")),c("./dist/plugins/formulaTextbox/formulatextbox-event.js"),c("./dist/plugins/formulaTextbox/formulatextbox-actions.js"),c("./dist/plugins/formulaTextbox/formulatextbox-render.js")},"./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js":function(a,b,c){"use strict";var d,e,f,g,h;Object.defineProperty(b,"__esModule",{value:!0}),d=c("Core"),e=c("./dist/plugins/formulaTextbox/formulatextbox.js"),f=null;function i(a){var b=d.Ul.Nl("textarea"),c=d.GC$(b);return c.css({display:"none"}),d.GC$(a).append(b),b}b.W4=i,g=function(){function a(){var a=this;a.nT=-1,a.Mk=-1,a._text="",a.Q2=-1,a.kj=null,a.MH=!1,a.R2=-1,a.I0=null,a.OC=null,a.f1=null}return a.prototype.$b=function(){var a=this;a.S2(),a.nT=-1,a.Mk=-1,a._text="",a.Q2=-1,a.MH=!1,a.R2=-1,a.kj=null,a.OC=null,a.f1=null},a.prototype.S2=function(){var a,b,c=this;c.kj.Js||(a=c.kj.getCellType(c.nT,c.Mk),b={sheet:c.kj,row:c.nT,col:c.Mk,sheetArea:3},c.I0&&c.I0.firstChild&&a.deactivateEditor(c.I0.firstChild.firstChild,b)),d.GC$(c.I0).remove(),c.I0=null},a.prototype.T2=function(a){var b=this,c=a.Cw;c&&(b._text=c.text(),b.nT=a.getActiveRowIndex(),b.Mk=a.getActiveColumnIndex(),b.Q2=c.caret(),b.MH=c.MH,b.R2=c.C1(),b.V4=c.V4,b.C5=c.C5,b.Nfa=c.Nfa,b.kj=a,b.OC=a.parent,b.f1=a.mm.bG())},a.prototype.VF=function(a){var b=this;a.Cw&&(b._text=a.Cw.text(),b.Q2=a.Cw.caret(),b.MH=a.Cw.MH,b.R2=a.Cw.C1())},a.prototype.U2=function(a){var b=this,c=a.Cw;c&&(c.V4=b.V4,c.C5=b.C5,c.Nfa=b.Nfa,c.text(b._text),c.caret(b.Q2),b.MH&&(c.B1(),c.C1(b.R2)))},a.prototype.V2=function(a){var b,c=a.oldSheet,d=this,e=c&&c.Cw;if(e)if(e.close(),(!d.kj||d.kj.Js)&&e.M0()||d.C5!==e.C5){d.T2(c),b=c.getValue(c.Jl,c.Kl,3),c.suspendEvent();try{if(!c.endEdit(!0))return}finally{c.resumeEvent()}c.setValue(c.Jl,c.Kl,b,3,!0),c.Px=1,a.needTriggerSheetChange=!1}else d._text&&(d.VF(c),e.destroy(),c.Cw=f,a.needTriggerSheetChange=!1)},a.prototype.W2=function(a){var b,c=a.oldSheet,d=a.newSheet,f=this;d.Js||(f.I0&&""===f._text&&(c.GJ(),f.$b()),f._text&&f.kj===d?(d.Px=0,d.zt(),d.suspendEvent(),f.V4?(b=i(d.parent.qo),e.J0(d,b),d.Px=2,d.yl.uH()):d.startEdit(!1),d.resumeEvent(),f.U2(d),f.VK(d,f.nT,f.Mk),c.GJ(),f.$b()):f._text&&!f.I0?(d.Px=1,c.Px=1,f.X2(d),d.EJ()):f._text&&f.kj!==d&&(d.Px=1,c.Px=1,f.X2(d),c.GJ(),d.EJ()))},a.prototype.X2=function(a){var b,c,g,h,i,j,k,l,m,n=this,o=n.kj;o.Js||(b=n.nT,c=n.Mk,g=o.getCellType(b,c),h={sheet:o,row:b,col:c,sheetArea:3,canvasOffset:this.f1},i=g.isImeAware(h),i&&(a.Px=1,j=g.a5(h),n.I0&&n.S2(),n.I0=j,d.GC$(j).css("position","absolute"),k=o.getCellRect(b,c),d.GC$(j).attr("id","across"),l=o.getActualStyle(b,c),g.d5(j,l,k,h),m=n.OC&&n.OC.getHost()||document.body,m.insertBefore(j,f),n.V4&&d.GC$(j).css({display:"none"}),e.J0(a,g.getEditingElement(),!0),j.firstChild&&!n.V4&&g.focus(j.firstChild.firstChild),n.U2(a),g.g5(j,l,k,h)))},a.prototype.VK=function(a,b,c){var d,e=a.getCellType(b,c),f=a.BF,g=a.am(),h=a.getActualStyle(b,c),i=a.getCellRect(b,c);i&&i.width>0&&i.height>0&&i.x>=g.kt&&i.y>=g.nt&&i.x+i.width<=g.lt+g.js&&i.y+i.height<=g.ot+g.gs&&(d={sheet:a,row:b,col:c,sheetArea:3},f&&f.parentNode&&e.g5(f.parentNode.parentNode,h,i,d,!0))},a}(),h=function(){function a(){}return a.Q0=function(b,c){a.H0||(a.H0=new g),a.H0.V2(c)},a.R0=function(b,c){a.H0||(a.H0=new g),a.H0.W2(c)},a}(),b.G0=h},"./dist/plugins/formulaTextbox/formulatextbox-actions.js":function(a,b,c){"use strict";var d,e,f,g,h,i,j;Object.defineProperty(b,"__esModule",{value:!0}),d=c("Core"),e=c("Common"),f=c("./dist/plugins/formulaTextbox/formulatextbox.js"),g=c("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js"),h=void 0,i=e.Common.j.Fa;function k(a){var b,c=a.Cw,d=a.mm;return b=c.MH?d.E2:d.E2={anchorRow:a.Jl,anchorCol:a.Kl,leadingRow:a.Qr,leadingCol:a.Rr}}function l(a,b,c,e,g){var h,j,l,m,n,o,p,q,r,s,t,u,v=a.Cw,w=a.parent,x=w&&w.options;if(v&&v.M0()&&x&&x.allowUserEditFormula&&x.enableFormulaTextbox){switch(h=k(a),j=h.anchorRow,l=h.anchorCol,m=h.leadingRow,n=h.leadingCol,i(e)&&(e=j),i(g)&&(g=l),o=a.mm,b){case 3:t=a.iy(e,g,c,m);break;case 4:t=a.hy(e,g,c,m);break;case 1:t=a.HJ(e,g,c,n);break;case 2:t=a.LJ(e,g,c,n);break;case 5:t=a.OJ();break;case 6:t=a.NJ()}t&&(p=t.row,q=t.col,r=t.leadingCellRow?t.leadingCellRow:p,s=t.leadingCellCol?t.leadingCellCol:q,a.IJ(p,q)&&(h.anchorRow=p,h.anchorCol=q,h.leadingRow=r,h.leadingCol=s,u=f.C2(o.kj,d.kf(p,q,1,1)),u&&v.v1(u,!1,!0),p>=0&&q>=0&&a.Yq(p,q)))}}function m(a,b){if(a){if(2===a.Px)return!1;var c=a.Cw;return c&&c.M0()?(l(a,b,!1),!0):(c&&(a=j.O2(a)),a.yx(b,!1),!0)}return!1}function n(a,b,c,d){if(a){if(2===a.Px)return!1;var e=a.Cw;return e&&e.M0()?(l(a,b,!1,c,d),!0):(e&&(a=j.O2(a)),a.yx(b,!1,c,d),!0)}return!1}function o(a,b,c){var e,g,h,i,j,l,m,n,o=a.Cw,p=a.parent,q=p&&p.options;o&&o.M0()&&q&&q.allowUserEditFormula&&q.enableFormulaTextbox&&(e=a.mm,g=k(a),h=g.anchorRow,i=g.anchorCol,o.MH?(l=o.m1(),j=f.L0(a,l.text)):j=d.kf(h,i,1,1),j&&(m=a.UJ(j,b,c,h,i),n=f.C2(e.kj,m),n&&o.v1(n,!0,!1)))}function p(a,b,c){if(a){if(2===a.Px)return!1;var d=a.Cw;return d&&d.M0()?(o(a,b,c),!0):(d&&(a=j.O2(a)),!!a.endEdit()&&(a.Sx(b,c),!0))}return!1}d.Commands.Ox=m,d.Commands.Qx=n,d.Commands.Rx=p,j=function(){function a(){}return a.fv=function(b){return a.O2(b)},a.Xx=function(b){return a.O2(b)},a.Yx=function(b){return a.O2(b)},a.O2=function(b){var c=b,d=g.G0.H0;return d&&d._text&&(c=d.kj,a.G2(c)),c},a.G2=function(a,b){var c,d;void 0===b&&(b=!0),c=a.parent,d=g.G0.H0,d&&d._text&&c.hw(a,b)},a.Zx=function(b,c,e){var g,h,i=!1,j=b.Cw;return j&&j.M0()?(g=k(b),g.anchorRow=c,g.leadingRow=c,h=f.C2(b,d.kf(g.anchorRow,g.anchorCol,1,1)),h&&j.v1(h,!1,!0),b.mq(e),i=!0):j&&(b=a.O2(b)),{sheet:b,r:i}},a._x=function(b,c,e){var g,h,i=!1,j=b.Cw;return j&&j.M0()?(g=k(b),g.anchorRow=c,g.leadingRow=c,h=f.C2(b,d.kf(g.anchorRow,g.anchorCol,1,1)),h&&j.v1(h,!1,!0),b.mq(e),i=!0):j&&(b=a.O2(b)),{sheet:b,r:i}},a.pzb=function(b,c){var d=!1,e=c?5:6,f=b.Cw,g=b.Jl,h=b.Kl;return f&&f.M0()?(f.MH||(b.mm.E2={anchorRow:g,anchorCol:h,leadingRow:b.Qr,leadingCol:b.Rr}),l(b,e,!1,g,h),d=!0):f&&(b=a.O2(b)),{sheet:b,r:d}},a.ay=function(b){return a.pzb(b,!0)},a.by=function(b){return a.pzb(b,!1)},a.ey=function(b){return a.O2(b)},a.gy=function(b){return a.O2(b)},a.jy=function(b){var c,d,e,i=g.G0.H0;if(i&&i._text&&(b=i.kj,c=i.nT,d=i.Mk,a.G2(b,!1),f.K0(b),b.Sr(c,d,h,h,1),b.isEditing()))return e=b.getValue(c,d,3),!!b.gv(!0,void 0,void 0,!0)&&(b.setValue(c,d,e,3,!0),!0)},a}(),d.Commands.Wx=j},"./dist/plugins/formulaTextbox/formulatextbox-event.js":function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m;Object.defineProperty(b,"__esModule",{value:!0}),d=c("Core"),e=c("CalcEngine"),f=c("SheetsCalc"),g=c("./dist/plugins/formulaTextbox/formulatextbox.js"),h=c("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js"),i=d.GC$.extend,j=null,k=void 0,l=Math.max,m=Math.min,i(d.iI.prototype,{D2:function(a){var b,c,e,f,h,i,j,l,m,n,o,p,q,r,s,t,u=this,v=u.kj,w=v.Cw;w&&(u.Kka(),b=v.frozenRowCount(),c=v.frozenColumnCount(),e=w.MH,e&&u.E2||(u.E2={anchorRow:-1,anchorCol:-1,leadingRow:-1,leadingCol:-1}),f=v.getRowCount(),h=v.getColumnCount(),i=a.hitTestType,j=a.row,l=a.col,m=u.shift,n=u.ctrl,o=u.E2,p=o.anchorRow,q=o.anchorCol,r=-1,s=-1,0===i?(r=b?v.ar():v.lq,s=c?v.$q():v.qq,t=d.kf(-1,-1,-1,-1),w.v1(g.C2(v,t),m,!n),u.OG=!0):1===i?(r=b?v.ar():v.lq,s=l,t=v.Jx(0,l,f-1,l,!0),m&&q>=0&&(t=v.Jx(0,l,f-1,q,!0)),t=d.kf(-1,t.col,-1,t.colCount),w.v1(g.C2(v,t),m,!n),u.OG=!0):2===i?(r=j,s=c?v.$q():v.qq,t=v.Jx(j,0,j,h-1,!0),m&&p>=0&&(t=v.Jx(j,0,p,h-1,!0)),t=d.kf(t.row,-1,t.rowCount,-1),w.v1(g.C2(v,t),m,!n),u.OG=!0):3===i&&(r=j,s=l,j!==k&&l!==k&&(t=v.Jx(j,l,j,l,!0),t=d.kf(t.row,t.col,1,1),m&&p>=0&&q>=0&&(t=v.Jx(j,l,p,q,!0)),w.v1(g.C2(v,t),m,!n)),u.OG=!0),u.DG=u.OG,m&&e||(o.anchorRow=r,o.anchorCol=s,o.leadingRow=r,o.leadingCol=s),u.rG={KG:a.rowViewportIndex,MG:a.colViewportIndex,sG:a.hitTestType},u.qG())},F2:function(a){var b,c,e=!1,f=h.G0.H0;if(f&&f.I0)if(b=f.kj,c=a.Cw,c&&b.setFormula(f.nT,f.Mk,c.text()),b!==a){if(d.Commands.Wx.G2(b),!b.endEdit())return;e=!0}else c&&(c.destroy(),a.Cw=j),f.$b();return e},EG:function(){var a,b=this,c=b.rG;c&&b.OG&&(a=c.sG,3===a?b.H2():2===a?b.I2():1===a&&b.J2())},H2:function(){var a,b,c,d,e=this,f=e.E2,h=f.anchorRow,i=f.anchorCol,j=e.fH(),k=e.gH();h>=0&&i>=0&&j>=0&&k>=0&&(a=e.kj,b=a.Jx(j,k,h,i,!0),c=g.C2(a,b),c&&(d=a.Cw,d.v1(c,!0,!1))),e.NG()},I2:function(){var a,b,c,e,f=this,h=f.E2.anchorRow,i=f.fH();h>=0&&i>=0&&(a=f.kj,b=a.Jx(i,0,h,a.getColumnCount()-1,!0),b=d.kf(b.row,-1,b.rowCount,-1),c=g.C2(a,b),c&&(e=a.Cw,e.v1(c,!0,!1))),f.NG()},J2:function(){var a,b,c,e,f=this,h=f.E2.anchorCol,i=f.gH();h>=0&&i>=0&&(a=f.kj,b=a.Jx(0,i,a.getRowCount()-1,h,!0),b=d.kf(-1,b.col,-1,b.colCount),c=g.C2(a,b),c&&(e=a.Cw,e.v1(c,!0,!1))),f.NG()},yH:function(){var a=this;a.RG(),a.rG=j,a.OG=!1,a.DG=!1},iG:function(a){var b,c,d,e,f,h,i,j,k=this,l=k.kj,m=k._oa(),n=a.formulaRangeHitInfo;n&&n.inBorder&&m&&(m.MH&&m.NH(),m.close(),b=n.paramRange,c=b&&b.text,c&&(d=g.L0(l,c),d&&(k.Kka(),e=l.Tq(d),f=a.row,h=a.col,f<e.row&&(f=e.row),f>=e.row+e.rowCount&&(f=e.row+e.rowCount-1),h<e.col&&(h=e.col),h>=e.col+e.colCount&&(h=e.col+e.colCount-1),i=f-e.row,j=h-e.col,k.OG=!0,k.FG=!0,k.K2={paramRange:b,fromRange:d,rowOffset:i,colOffset:j},k.rG={KG:a.rowViewportIndex,MG:a.colViewportIndex,sG:a.hitTestType},k.qG())))},GG:function(){var a,b,c,e,f,h,i,j,k,n,o,p,q,r,s,t,u,v,w,x,y,z=this;z.OG&&z.FG&&(a=z.fH(),b=z.gH(),a>=0&&b>=0&&(c=z.K2,e=c.fromRange,f=c.rowOffset,h=c.colOffset,i=c.toRow,j=c.toCol,k=a,n=b,k===i&&n===j||(c.toRow=k,c.toCol=n,o=z.kj,p=o.getRowCount(),q=o.getColumnCount(),r=e.row,s=e.col,t=e.rowCount,u=e.colCount,v=r<0?-1:l(0,m(p-t,a-f)),w=s<0?-1:l(0,m(q-u,b-h)),x=g.C2(o,d.kf(v,w,t,u)),x&&(y=z._oa(),y.D1(c.paramRange.index,x,!0)))),z.NG())},zH:function(){var a,b=this;b.RG(),b.OG=!1,b.FG=!1,b.K2=j,a=b._oa(),a.onRangeMoved&&a.onRangeMoved()},jG:function(a){var b,c,d,e,f,h,i,j,k,l,m,n=this,o=n.kj,p=n._oa(),q=a.formulaRangeHitInfo;if(q&&p&&(p.MH&&p.NH(),b=q.paramRange,c=b&&b.text,b&&c&&(d=g.L0(o,c)))){if(n.Kka(),e=d.row,f=d.row<0?-1:d.row+d.rowCount-1,h=d.col,i=d.col<0?-1:d.col+d.colCount-1,q.inTopLeft)j=f,k=i,l=e,m=h;else if(q.inTopRight)j=f,k=h,l=e,m=i;else if(q.inBottomLeft)j=e,k=i,l=f,m=h;else{if(!q.inBottomRight)return;j=e,k=h,l=f,m=i}n.OG=!0,n.HG=!0,n.L2={paramRange:b,anchorRow:j,anchorCol:k,toRow:l,toCol:m},n.rG={KG:a.rowViewportIndex,MG:a.colViewportIndex,sG:a.hitTestType},n.qG()}},kG:function(a,b){var c=a.Cw;return c&&c.M0()?(this.D2(b),!0):!!this.F2(a)},IG:function(){var a,b,c,e,f,h,i,j,k,n,o,p,q,r,s,t,u,v,w,x,y=this;y.OG&&y.HG&&(a=y.fH(),b=y.gH(),a>=0&&b>=0&&(c=y.L2,e=c.anchorRow,f=c.anchorCol,h=c.toRow,i=c.toCol,j=a,k=b,j===h&&k===i||(c.toRow=j,c.toCol=k,n=y.kj,o=n.getRowCount(),p=n.getColumnCount(),q=e<0?o-1:e,r=f<0?p-1:f,s=m(q,j),t=m(r,k),u=l(q,j)-s+1,v=l(r,k)-t+1,0===s&&u===o&&(s=-1,u=-1),0===t&&v===p&&(t=-1,v=-1),w=g.C2(n,d.kf(s,t,u,v)),w&&(x=y._oa(),x.D1(c.paramRange.index,w,!0)))),y.NG())},AH:function(){var a,b,c=this;c.RG(),c.OG=!1,c.HG=!1,c.L2=j,a=c._oa(),a.V4&&(a.W0=1,b=a.text().lastIndexOf(",",a.caret()),b!==-1&&(a.W0=b+1)),a.onRangeResized&&a.onRangeResized()},vr:function(a,b,c){var d,e,f,i,k,l,m,n,o,p,q,r,s=this.kj,t=this._oa(),u=t&&t.l1();if(!u||0===u.length||!t.UQa)return j;if(d=a.rowViewportIndex,e=a.colViewportIndex,this.qH(d,e,b,c))return j;for(l=u.length-1;l>=0;l--)if(f=u[l],f.allowDrag!==!1&&(m=h.G0.H0,(!m||!m._text)&&(i=g.L0(s,f.text)))){if(k=s.getRangeRect(d,e,i),n=5,o=k.x-2,p=k.x+k.width+1-n,q=k.y-2,r=k.y+k.height+1-n,o+n<=b&&b<p&&(q+1<=c&&c<=q+3||r+1<=c&&c<=r+3))return{paramRange:f,inBorder:!0};if(q+n<=c&&c<r&&(o+1<=b&&b<=o+3||p+1<=b&&b<=p+3))return{paramRange:f,inBorder:!0};if(p<=b&&b<p+n&&r<=c&&c<r+n)return{paramRange:f,inBottomRight:!0};if(o<=b&&b<o+n&&r<=c&&c<r+n)return{paramRange:f,inBottomLeft:!0};if(p<=b&&b<p+n&&q<=c&&c<q+n)return{paramRange:f,inTopRight:!0};if(o<=b&&b<o+n&&q<=c&&c<q+n)return{paramRange:f,inTopLeft:!0}}return j},_oa:function(){var a=this.kj;return a.Cw||a.Cva},ly:function(){var a,b,c,d,g,h,i,k,l,m,n,o,p,q=this,r=q.kj,s=r.Cw;if(s)if(a=r.Jl,b=r.Kl,c=r.parent,d=c&&1===c.options.referenceStyle,g=new f.SheetParserContext(r,d,e.pf(a,b)),h=new e.Parser,s.MH)for(l=s.u1(),m=0;m<l.length;m++){i=l[m];try{k=h.parse(g,i.text)}catch(a){k=j}k&&1===k.type&&(q.M2(k,a,b,!0,!0),s.D1(i.index,h.unparse(g,k)))}else{if(i=s.m1(),!i)return;try{k=h.parse(g,i.text)}catch(a){k=j}if(!k)return;1!==k.type||k.sf()?1===k.type&&(q.N2(k,a,b),s.D1(i.index,h.unparse(g,k))):(n=i.textOffset+i.text.lastIndexOf(":"),o=s.caret()<=n,o?(q.M2(k,a,b,!0,!1),p=h.unparse(g,k),s.D1(i.index,p),s.caret(i.textOffset+p.lastIndexOf(":"))):(q.M2(k,a,b,!1,!0),s.D1(i.index,h.unparse(g,k))))}},M2:function(a,b,c,d,e){var f,g,h=a.rowRelative,i=a.columnRelative;d&&(h&&i?(a.rowRelative=!1,a.columnRelative=!1,a.row+=b,a.column+=c):h?(a.columnRelative=!0,a.column-=c):i?(a.rowRelative=!0,a.columnRelative=!1,a.row-=b,a.column+=c):(a.columnRelative=!0,a.column-=c)),f=a.endRowRelative,g=a.endColumnRelative,e&&(f&&g?(a.endRowRelative=!1,a.endColumnRelative=!1,a.endRow+=b,a.endColumn+=c):f?(a.endColumnRelative=!0,a.endColumn-=c):g?(a.endRowRelative=!0,a.endColumnRelative=!1,a.endRow-=b,a.endColumn+=c):(a.endColumnRelative=!0,a.endColumn-=c))},N2:function(a,b,c){var d=a.rowRelative,e=a.columnRelative;d&&e?(a.rowRelative=!1,a.columnRelative=!1,a.row+=b,a.column+=c):d?(a.columnRelative=!0,a.column-=c):e?(a.rowRelative=!0,a.columnRelative=!1,a.row-=b,a.column+=c):(a.columnRelative=!0,a.column-=c)},Kka:function(){var a,b=this.kj,c=b.Cw;c&&(a=c.qo,a&&c.Cia(a)&&c.Jka())}})},"./dist/plugins/formulaTextbox/formulatextbox-render.js":function(a,b,c){"use strict";var d,e,f,g,h,i;Object.defineProperty(b,"__esModule",{value:!0}),d=c("Core"),e=c("Common"),f=c("./dist/plugins/formulaTextbox/formulatextbox.js"),g=c("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js"),h=d.GC$.extend,i=e.Common.u,h(d.oJ.prototype,{uH:function(){var a,b,c=this,d=c.kj;d.Xq>0||(a=d.am(),b=c.bm(),c.Mx(a.x,a.y,a.width,a.height),c.Pw(b))}}),d.Worksheet.$n("formulatextboxrender",{paintAdornment:function(a){var b,c,d,e=this,f=a.ctx,g=a.clipRect,h=e.yl,i=e.am(),k=e.mm._oa();if(k)for(c=0;c<=2;c++)for(d=0;d<=2;d++)b=i.Ft(c,d),b&&0!==b.width&&0!==b.height&&j(h,f,c,d,g,k)}});function j(a,b,c,d,h,j){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=a.kj,M=L.mm,N=j&&j.l1(),O=N&&N.length;if(!(O<=0)&&(k=a.VI(c,d,h))){for(b.save(),b.rect(k.x,k.y,k.width,k.height),b.clip(),b.beginPath(),l=[],m=M.isFormulaRangeHoving,n=M.tH,o=M.FG,p=M.K2,q=M.HG,r=M.L2,x=0;x<O;x++)if(s=N[x],t=s.text,u=s.ranges&&s.ranges.length>0?s.ranges:[f.L0(L,t)]){if(y=g.G0.H0,y&&y.kj)if(i.Bb(t,"!")){if(z=i.Ib(t,"!"),L.name()!==z&&"'"+L.name()+"'"!==z)continue}else if(A=i.Ib(t,"["),B=L.tables,!(L.getCustomNames()[A]||B&&B.findByName(A)))continue;for(v=a.XI(c,d,u,k),C=0;C<v.length;C++)D=v[C],D&&D.width>0&&D.height>0&&(w=j.o1(x),j.t1(s)?(m&&n.paramRange.index===x&&(b.beginPath(),b.lineWidth=2,b.strokeStyle=w,b.rect(D.x+1,D.y+1,D.width-3,D.height-3),b.stroke()),a.fJ(b,D,w)):m&&n.paramRange.index===x||o&&p.paramRange.index===x||q&&r.paramRange.index===x?(b.beginPath(),b.lineWidth=2,b.strokeStyle=w,b.rect(D.x+1,D.y+1,D.width-3,D.height-3),b.stroke()):(b.beginPath(),b.lineWidth=2,b.strokeStyle=w,b.rect(D.x,D.y,D.width-1,D.height-1),b.stroke()),j.n1(s)&&(E=e.Common.pc.ec(w),E.a=.1,b.beginPath(),b.fillStyle=e.Common.pc.bc(E),b.fillRect(D.x+1,D.y+1,D.width-3,D.height-3)),l.push({rect:D,color:w,allowDrag:s.allowDrag}))}if(l.length>0&&j.UQa)for(F=l.length,x=0;x<F;x++)D=l[x].rect,w=l[x].color,G=5,H=D.x-2,I=D.x+D.width+1-G,J=D.y-2,K=D.y+D.height+1-G,l[x].allowDrag!==!1&&(y=g.G0.H0,y&&y._text||(b.beginPath(),b.fillStyle=w,b.fillRect(H,J,G,G),b.fillRect(I,J,G,G),b.fillRect(H,K,G,G),b.fillRect(I,K,G,G)));b.beginPath(),b.restore()}}},"./dist/plugins/formulaTextbox/formulatextbox.js":function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;Object.defineProperty(b,"__esModule",{value:!0}),d=c("CalcEngine"),e=c("SheetsCalc"),f=c("Common"),g=c("Core"),h=c("./dist/plugins/formulaTextbox/formulatextbox-acrosssheet.js"),i=null,j=void 0,k=Math.max,l=Math.min,m=g.GC$.extend,n=g.Ul.Nl,o=window,p=document,q=f.Common.u,r=g.Ul.nl,s=g.Ul.Ml,t=s.msie&&parseInt(s.version,10)<10,u=q.Nb,v="formulatextbox",w="gcUIElement",x="input",y="\xa0",z=".gcFormulaTextBoxInternal",A=".gcFormulaTextBox",B="TextChanged",C="CaretChanged",D="AppendStarted",E="AppendEnded",F={left:37,right:39,up:38,down:40,tab:9,enter:13,pup:33,pdn:34,end:35,home:36,esc:27},G=["#0000ff","#008000","#9900cc","#800000","#00cc33","#cc6600","#cc0099"],H='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAARCAIAAACw+gCQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJSSURBVDhPY3hILqBYZ/eqV81LXpbNfp7S/yS0+Z5p+olD5x5OWXGyYcaBmql7yifuLOnbBkRFPVuACKIFqjNzwv2Qhhue5ReByK/qYlDtxb///n35+efd1z/PP/wB6vn2+/f7b79ffgIhiBaoTlPP5I2bN2/asmX7jh3Hjh+ft3wLUOfX779ef/h+6+nHtXsuffrx+/bj16euvwQiiBaETiAy904NTasGantRkvA8wetpsO0NJ839htKb9l/Jal6T3rgytX4FEEG0QHXuOnbr55+/P379AyIg40m8x8uZ3U+aC49bKn64eHzX0es4Xds0Y9ejl++vPXx3+f77Nx9/3PU3e5YR/CTM4WGs53pVPqBrgX6+8+QNFtdmNq0q6NpU1LOpe/6+o+fvH3fR36XCc9dE/KG3EdDNQPaF7VunLTuY0bA0omg2RAtUZ1LNUohjgCEJDJVtdlpPty6dr8x3yUDsvoPqRm2hqcp8Jy+9WbH/7cQ1EB0wnXEVCyBBt+fc8+NXXy9Yf/znz5/31swFaliiKjBZme/yrSe7z36YsuZBy4KbEC1QnRFFcxKqFgP1A1Fq7ZKcpqU1EzYuWX/kxIa1/WBtizYcAwqG5E71SZsA0QLVGZI3A+Lax+/+ACMwvHDmsn1v1xx8e+jSp83HXgP1ALmztryYsv4ZEEG0QHUGZk+FuHbHqadABORO3fC8Z/mdvmU3Oxdd9cuY1LX0VsOci/WzQQiiBaET4lQgii1fEFU6F4iAXgC6JShnakDWZKBmoDshCKIFqpMMQK7Ohw8BTajNa73pg9oAAAAASUVORK5CYII=")',I='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAARCAIAAACw+gCQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAItSURBVDhPY3hILqBYZ/eqVxDUuvRl/cKXZbNf5E59ntT3DIgi2p/6NT5xq35iV/YYiCyLHkG0IHQuOvR/1t6/03b+mbD1d/eGXy2rf9Yu/wFE5Yu+Fc79mjXza+rUz0BkmHoWogXFTqCFVfNfQmwLa3vqVfsYiBzA9sCRftIJiBaozuYZO+89eAREt+4+AKIbt+9fvXkPiC5du3P28s0T564dOnV579Hz2w6cSaqcDdEC1Vk/ZQtQQ2vv7MaumbUd0+o6ZzT3zmnunQ1kF9T0pZe2J+U3x+U0bNx9MqZ4CkQLVGdB6xKgDaX1/b/+/PnyE4E+ff/z8uPvR29/3X35MzCxfPW2o2HZPRAtUJ2lXSuADkstann/9febz7/ff/3zLDP4Spj9Pjs1oE6gthvPfnpEFS7deDAwrRWiBaozv3kh0D8RadVAlFvZvWLDrjvRrk+bCrdpCS1ZsyOpoMU9ssA5NBeo0zuhDqIFqjO9Zubhk1eA6MT5G+eu3H78/PVFX/OnxQnrNQTuPnyx9+hFoA+B2uav2ecaVQ7RAtUZVzQBKH3g+KXTl24fdjE44mp4yFbtSYrfGg3+yQocQLTryEWgzgVr9zmEFkK0QHWGZbbvPHQOiI6cvnb5wMENhjJPE30eB1k9dFIDaruy/wAwPoA6563eaxOQDdEC1YkG1hvKrNKVuOEA0nYr2Pp5qA1UAglg1wkEW03lF2kI3wy1xaoNCHDqJAjI1fnwIQDHT83/UVFPcQAAAABJRU5ErkJggg==")',J="background",K="background-repeat",L="text-before",M="caret-before",N="\u200b";function S(a){return a.getActiveSheet()}function T(a,b){var c,d=0;for(c=0;c<a.length;c++)a[c]===b&&d++;return d}function U(){var a=[];return g.GC$.each(d.sR()._h,function(b,c){d.Functions.bi[b]&&(c.name=b,a.push(c))}),a}function V(a){var b=[],c;return g.GC$.each(a,function(a,d){c=d.description(),c&&(c.name=a,b.push(c))}),b}function W(a,b){if(!a)return!1;var c=!1,d=!1;if(1===b.rowCount){if(a.hasHeadersRow()&&b.row===a.startRow())return!0;if(a.hasTotalsRow()&&b.row===a.endRow())return!0}else a.hasHeadersRow()&&b.row===a.startRow()&&(b.rowCount===a.dataRange().rowCount+1&&(c=!0),a.hasTotalsRow()&&b.rowCount===a.dataRange().rowCount+1+1&&(c=!0)),b.row===a.dataRange().row&&(b.rowCount===a.dataRange().rowCount&&(c=!0),a.hasTotalsRow()&&b.rowCount===a.dataRange().rowCount+1&&(c=!0));return b.col+b.colCount<=a.startColumn()+a.dataRange().colCount&&(d=!0),c&&d}function X(a){return a.replace(/'/g,"''")}function Y(a){var b=a.name();return e.jma(b.split(""),!1)?b:"'"+X(b)+"'"}function Z(a){var b=d.getMapping()&&d.getMapping().builtInFunctionsMapping;return b&&b[a]&&b[a].alias||a}function $(a,b){var c,d,f,j,k,l,m,n,o,p,q,r;return b?(c=a.Cw,d=h.G0.H0,f=d&&d.kj||a,j=f.Jl,k=f.Kl,l=a.parent,m=l&&1===l.options.referenceStyle,n=15,a.Cw&&a.Cw.Nfa&&(n=0),b.row<0&&b.col<0&&(b=new g.Range(0,(-1),a.getRowCount(),(-1))),o=a.tables,p=o&&o.find(b.row,b.col),d&&d.Nfa&&(n=0),c&&!c.V4&&W(p,b)?(d&&d._text&&d.kj!==a&&(j=k=-1),e.rangeToFormulaWithStructReference(a,b,j,k,n,m,p)):(q=e.rangeToFormula(b,j,k,n,m),(d&&d._text||a.Cw&&a.Cw.V4&&a.Cw.ria)&&(r=Y(a),q=r+"!"+q),q)):i}b.C2=$,g.Events.FormulaTextBoxTextChanged="FormulaTextBoxTextChanged",g.Events.FormulaTextBoxCaretChanged="FormulaTextBoxCaretChanged",o.Yl.km.push(function(a,b){var c,d=h.G0;!b&&a.endEdit&&d&&(c=d.H0,c&&c.I0&&a.Cw&&(a.Cw&&a.Cw.destroy(),a.Cw=i,c.$b()))});function _(a,b,c){var e,f,h,i,j,k=a.parent,l=k&&k.options;(b&&l&&l.allowUserEditFormula&&l.enableFormulaTextbox||c)&&(a.Cw&&a.Cw.destroy(),a.Cw=new R(b,null,k),e=a.Cw.text(),f=a.getFormulaInformation(a.Jl,a.Kl),"="!==e[0]||f&&f.hasFormula||(e="'"+e,a.Cw.text(e)),h=a.Cw,i=a.mm,j=a.yl,h.bind("AppendStarted",function(){h.close();var b=a.Px;1!==b&&(a.Px=1,a.Cu(b,1))}),h.bind("AppendEnded",function(){j.uH()}),h.bind(B,function(b,c){if(!a.Js){if(c&&c.type!==x){i.Qw(c);var d=a.Jl,e=a.Kl,f=a.getCellType(d,e);a.Wq(g.Events.EditChange,{sheet:a,sheetName:a.name(),row:d,col:e,editingText:f.getEditorValue(a.BF)})}j.uH(),a.Wq(g.Events.FormulaTextBoxTextChanged,{sheet:a,sheetName:a.name(),text:h.text()})}}),h.bind("CaretChanged",function(){j.uH(),a.Wq(g.Events.FormulaTextBoxCaretChanged,{sheet:a,sheetName:a.name(),caret:h.caret()})}),h.add(U()),h.add(V(d.Functions.ci)),h.add(V(a.Su).concat(V(k.Su))),j.uH())}b.J0=_;function aa(a){a.Cw&&(a.Cw.destroy(),a.Cw=i,a.yl.uH());var b=a.parent&&a.parent.CF;p.activeElement===(b&&b.qo)&&a.mm.Qq()}b.K0=aa;function ba(a,b){var c,d,f,g;if(!b)return i;c=h.G0.H0,d=c&&c.kj||a,f=d.Jl,g=d.Kl;try{return e.formulaToRange(a,b,f,g)}catch(a){}return i}b.L0=ba,m(g.DC.prototype,{bE:function(a){return!(a&&a.Cw&&a.Cw.M0())}}),g.Worksheet.$n(v,{startEdit:function(a){_(this,a.element)},endEdit:function(){aa(this)}}),O=g.DC.prototype,P=O.dE,g.DC.$n(v,{preProcessMouseDbClick:function(a){var b=S(this.OC),c=b?b.Cw:void 0,d=c&&c.M0(),e=h.G0.H0;d?a.r=!1:e&&e.I0&&e.$b()}}),O.dE=function(){var a=S(this.OC),b=a.Cw,c=h.G0.H0,d=c&&c._text;return P.call(this)&&!d&&!b},Q=1;function ca(a,b){var c,d,e,f,h,i,j,k,l,m,o=g.GC$(a);return o.attr("contenteditable","false"),c=n("table"),g.GC$(c).css("border-spacing","0"),g.GC$(c).css("width","100%"),o.append(c),d=n("tbody"),c.appendChild(d),e=document.createElement("tr"),d.appendChild(e),f=document.createElement("td"),g.GC$(f).css("padding-right","0px"),e.appendChild(f),h=document.createElement("td"),g.GC$(h).css("width","23px"),g.GC$(h).css("padding-right","0px"),e.appendChild(h),i=o.width()-g.GC$(h).width(),j=n("div"),k=n("div"),g.GC$(k).width(i),g.GC$(k).css({"overflow-y":"auto","overflow-x":"hidden",height:"20px"}),k.appendChild(j),f.appendChild(k),l=n("div"),h.appendChild(l),g.GC$(j).css({display:"inline-block",float:"left",height:"auto",outline:"none"}),g.GC$(j).width(i),g.GC$(j).attr("contenteditable","true"),g.GC$(j).attr("spellcheck","false"),m=g.GC$(l),m.css({display:"block",float:"right",width:"23px",height:"23px",background:H,"background-repeat":"no-repeat"}),m.bind("click",function(){b.D5?(b.OC.Wq("RangeSelectEnding",b),b.endSelectMode()):b.startSelectMode()}),{contentDiv:j,button:l}}function da(a){var b,c=["FILTER","RANDARRAY","SEQUENCE","SORT","SORTBY","UNIQUE"];for(b=0;b<c.length;b++)if(a===c[b])return!0}R=function(){function a(a,b,c){var d,e,f,i,j=this,k=a;if(j.V4=!1,j.Nfa=!1,j.ria=!0,j.Ac=[],j.Bc=[],b&&b.rangeSelectMode&&(b.absoluteReference===!0&&(j.Nfa=!0),b.needSheetName===!1&&(j.ria=!1),j.V4=!0,j.D5=!1,j.E5=!1,j.cga=a,d=ca(a,j),k=d.contentDiv,j.sia=d.button,j.tia=a,j.C5=Q,Q++),j.UQa=!0,j.ad(c&&c.getHost()||p.body),k&&j.N0(k),c&&(j.O0=!0,j.P0(c),j.OC.Gu(g.Events.FormulatextboxActiveSheetChanging,h.G0.Q0),j.OC.Fu(g.Events.FormulatextboxActiveSheetChanging,h.G0.Q0),j.OC.Gu(g.Events.FormulatextboxActiveSheetChanged,h.G0.R0),j.OC.Fu(g.Events.FormulatextboxActiveSheetChanged,h.G0.R0)),e=j.text(),j.S0=j.T0(e),f=j.Cia(k)){j.V0(j.S0);try{i=o.getSelection(),i.selectAllChildren(k),i.rangeCount>0&&i.collapseToEnd()}catch(a){}g.GC$(j.qo).data(L,e)}}return a.prototype.j5=function(a){var b,c,d,e,f,g,i=this;i.O1(),i.UF(),i.E5=!0,b=h.W4(i.OC.qo),c=i.a1(),c.suspendPaint(),_(c,b,!0),d=c.Cw,d.V4=!0,d.C5=i.C5,d.Nfa=i.Nfa,d.ria=i.ria,a&&(i.text(a),i.caret(a.length)),e=i.text(),f=i.caret(),f<=0&&(f=e.length),i.focus(),i.caret(f),i.MH=!0,i.W0=1,g=e.lastIndexOf(",",f),g!==-1&&(i.W0=g+1),e||(i.text("="),e="=",i.caret(1),f=1),0!==e.indexOf("=")&&(e="="+e,f++),d.text(e),d.caret(f),d.MH=i.MH,d.W0=i.W0,c.resumePaint()},a.prototype.startSelectMode=function(a){var b,c=a;c&&0!==c.indexOf("=")&&(c="="+c),b=this,b.V4=!0,b.D5=!0,g.GC$(b.sia).css([J,K],[I,"no-repeat"]),b.j5(c)},a.prototype.endSelectMode=function(){this.D5=!1,this.H5(),g.GC$(this.sia).css([J,K],[H,"no-repeat"])},a.prototype.H5=function(){var a=this.a1();a.gv(!0,j,!0),a.repaint()},a.prototype.destroy=function(){var a=this;a.D5&&a.H5(),a.MH=!1,a.W0=-1,a.X0(),a.Y0(),g.GC$(a.Z0).remove(),g.GC$(a.$0).remove(),g.GC$(a._0).remove()},a.prototype.bind=function(a,b,c){var d=this.qo;d&&a&&(a=a.split(/\s+/).join(A+" "),g.GC$(d).bind(a+A,b,c))},a.prototype.unbind=function(a,b){var c=this.qo;c&&a&&(a=a.split(/\s+/).join(A+" "),g.GC$(c).unbind(a+A,b))},a.prototype.unbindAll=function(){var a=this.qo;a&&g.GC$(a).unbind(A)},a.prototype.caret=function(a){var b,c,d=this,e=d.qo;if(e)return b=p.activeElement===e,c=g.GC$(e),0===arguments.length?b?d.b1(e).end:c.data(M):void(a!==d.caret()&&(b?(d.c1(e,a),c.data(M,d.b1(e).end)):c.data(M,a),d.Wq(C,{})))},a.prototype.b1=function(a){var b,c,d,e=this,f=-1,g=-1;return e.d1(a)?(f=a.selectionStart,g=a.selectionEnd):e.Cia(a)&&(b=o.getSelection(),b.rangeCount>0&&(c=b.getRangeAt(0),d=c.cloneRange(),d.selectNodeContents(a),d.setEnd(c.endContainer,c.endOffset),g=(""+d).length,d=c.cloneRange(),d.selectNodeContents(a),d.setEnd(c.startContainer,c.startOffset),f=(""+d).length,d.detach())),{start:f,end:g}},a.prototype.c1=function(a,b){var c,d,e,f,g=this;g.d1(a)?a.setSelectionRange(b,b):g.Cia(a)&&(e=this.e1(a,b),e&&(c=o.getSelection(),d=p.createRange(),f=e.node,f&&1===f.childNodes.length?d.setStart(f.firstChild,e.offset):f.lastChild&&f.lastChild.length&&d.setStart(f.lastChild,f.lastChild.length),d.collapse(!0),c.removeAllRanges(),c.addRange(d),this.V4&&(a.parentElement.scrollTop=a.parentElement.scrollHeight)))},a.prototype.text=function(a){var b,c,d,e,f,i,j,k,l=this,m=l.qo,n=l.a1();if(!m||!n||n.Js)return"";if(b=l.d1(m),c=l.Cia(m),0===arguments.length){if(d="",b)d=m.value;else if(c){if(e=m.getElementsByClassName("gcsj-func-gray-formula"),e.length>0)return"";d=t?g.Ul.Woa(m):m.innerText,d=d.replace(/\r\n?/g,"\n"),d.indexOf(y)>=0&&(d=g.Ul.Ika(d,y," "))}return d}null!==a&&void 0!==a||(a=""),a!==l.text()&&(f=l.mLb(a),f?l.S0=l.T0(f):l.S0=l.T0(a),b?m.value=a:c&&(i=l.nLb(l.S0,a),l.V0(i),l.caret(a.length)),j={},k=h.G0.H0,k&&k._text&&(j={sheet:k.kj,editor:k.I0&&k.I0.firstChild.firstChild,canvasOffset:k.f1}),l.Wq(B,j)),l.oLb&&l.pLb()},a.prototype.autoComplete=function(a){return 0===arguments.length?this.g1:void(this.g1=a)},a.prototype.showHelp=function(a){return 0===arguments.length?this.h1:void(this.h1=a)},a.prototype.add=function(a){var b,c;if(a)if(g.GC$.isArray(a))for(b=a.length,c=0;c<b;c++)this.Sb(a[c]);else this.Sb(a)},a.prototype.Sb=function(a){var b,c,d,e,f=a&&u(Z(a.name));if(f){for(b=this.i1,c=b.length,d=0;d<c;d++){if(e=u(b[d].name),e===f)return;if(e>f)break}b.splice(d,0,a)}},a.prototype.remove=function(a){var b,c,d;if(a)for(a=u(a),b=this.i1,c=b.length,d=0;d<c;d++)if(u(b[d].name)===a){b.splice(d,1);break}},a.prototype.workbook=function(a){var b=this;return 0===arguments.length?b.OC:void(a===i?b.V4&&b.H5():(b.P0(a),b.j1()))},a.prototype.P0=function(a){var b,c;a&&(b=this,b.OC&&b.Y0(),c=b.qo,c&&(b.OC=a))},a.prototype.l1=function(){var a,b,c,d=[],e=this.S0,f=e&&e.length,g=0,h=0;if(f>0)for(c=0;c<f;c++)a=e[c],b=a.text,11===a.type&&(d.push({textOffset:g,text:b,ranges:a.ranges,index:h,allowDrag:a.allowDrag}),h++),g+=b.length;return d},a.prototype.m1=function(){var a,b,c,d,e,f=this.qo,g=this.l1();if(f&&g&&g.length>0)for(a=this.caret(),b=g.length,c=void 0,d=void 0,e=0;e<b;e++){if(c=g[e],d=c.textOffset,d<a&&a<=d+c.text.length)return c;if(d>=a)break}return i},a.prototype.n1=function(a){var b,c,d;return!!a&&(b=this.caret(),c=a.text,d=a.textOffset,d<b&&b<=d+c.length)},a.prototype.o1=function(a){var b,c,d,e,f,g,h,i=this.l1(),j=i.length;if(a<0||j<=a)return"";for(b=[],d=0,e=0;e<j;e++){for(c=i[e],f=!1,g=0;g<b.length;g++)if(b[g].text.replace(/\s+/g,"").toUpperCase()===c.text.replace(/\s+/g,"").toUpperCase()){f=!0;break}if(f){if(a===e){d=g;break}}else if(b.push(c),a===e){d=b.length-1;break}}return h=G,h[d%h.length]},a.prototype.M0=function(){var a,b,c;return!!this.MH||(!!this.V4||(a=this.s1(this.caret()),!!a&&(b=a.type,c=a.text,1===b||8===b||7===b&&"%"!==c||5===b||9===b||15===b)))},a.prototype.t1=function(a){if(!a||!this.MH)return!1;var b=this.W0,c=this.caret(),d=a.textOffset;return b<=d&&d<c},a.prototype.u1=function(){var a,b,c=[],d=this.l1(),e=d.length;if(e>0)for(b=0;b<e;b++)a=d[b],this.t1(a)&&c.push(a);return c},a.prototype.v1=function(a,b,c){var d,e,g,i,j,k,l,m,n,o,p,q=this,r=q.qo;if(a&&r){if(!q.MH){if(!q.M0())return;b=!1,q.MH=!0,q.W0=q.caret(),q.Wq(D,{})}d=q.W0,e=q.text(),g=q.caret(),e||(e="=",d=q.W0=1,g=1),i=g,c&&(b=!1,e=e.substr(0,d)+e.substr(g),q.S0=q.T0(e),g=d,i=g),j=q.s1(g),b?(k=e.substr(0,g),k=k.substr(0,k.length-j.text.length),k.length>=d&&(j.text=a,i=k.length+a.length)):(l=q.S0,m=f.Common.k.Cb(l,j),n=q.V4&&l.length>1&&m===l.length-1&&11===j.type,g>d||n?(l.splice(m+1,0,{text:this.w1(),type:8}),l.splice(m+2,0,{text:a,type:11}),a=","+a):l.splice(m+1,0,{text:a,type:11}),i=g+a.length),q.z1(),o={},p=h.G0.H0,p&&p._text&&(o={sheet:p.kj,editor:p.I0&&p.I0.firstChild.firstChild,canvasOffset:p.f1}),q.Wq(B,o),q.caret(i)}},a.prototype.NH=function(){var a=this;a.MH&&(a.MH=!1,a.W0=-1,a.Wq(E,{}))},a.prototype.B1=function(){this.MH=!0,this.W0=this.caret()},a.prototype.C1=function(a){return void 0!==a&&(this.W0=a),this.W0},a.prototype.D1=function(a,b,c){var d,e,f,g,h,i,j,k=this,l=k.qo;if(l&&!(a<0)&&b){for(d="",e=!1,f=k.S0,g=f&&f.length,i=0,j=0;j<g;j++){if(h=f[j],11===h.type&&i++===a){f[j]={text:b,type:11},e=!0;break}d+=h.text}e&&(k.z1(),k.Wq(B,{}),c?k.caret(k.text().length):k.caret(d.length+b.length))}},a.prototype.j1=function(){var a,b,c=this;c.OC&&(a=c.qo,c.OC&&a&&(a.setAttribute(w,"gcAttachedFormulaTextBox"),c.V4||(c.OC.CF=c),c.OC.Fu(g.Events.FormulatextboxEditStarted,c,c.E1),c.OC.Fu(g.Events.FormulatextboxEnterCell,c,c.F1),c.OC.Fu(g.Events.FormulatextboxEditEnded,c,c.G1),c.OC.Fu(g.Events.FormulatextboxActiveSheetChanged,c,c.H1),c.OC.Fu(g.Events.FormulatextboxRangeChanged,c,c.I1),c.OC.Fu(g.Events.FormulaTextBoxTextChanged,c,c.J1),c.OC.Fu(g.Events.FormulaTextBoxCaretChanged,c,c.K1),c.OC.Fu(g.Events.ValueChanged,c,c.qLb),b=S(c.OC),b&&!c.V4&&c.text(c.L1(b,b.Jl,b.Kl)),
c.Fu(B,c,c.M1),c.Fu(C,c,c.N1)))},a.prototype.refresh=function(a){var b,c=this.OC,d=this;c&&(b=S(c),b&&!d.V4&&(d.OG=!!a||d.OG,d.text(d.L1(b,b.Jl,b.Kl)),d.OG=!1))},a.prototype.Y0=function(){var a=this,b=a.OC;!a.O0&&b&&(a.V4||(b.CF=null,b.Gu(g.Events.FormulatextboxEditStarted,a.E1),b.Gu(g.Events.FormulatextboxEnterCell,a.F1),b.Gu(g.Events.FormulatextboxEditEnded,a.G1),b.Gu(g.Events.FormulatextboxActiveSheetChanged,a.H1),b.Gu(g.Events.FormulatextboxRangeChanged,a.I1),b.Gu(g.Events.FormulaTextBoxTextChanged,a.J1),b.Gu(g.Events.FormulaTextBoxCaretChanged,a.K1),b.Gu(g.Events.ValueChanged,a.qLb),a.Gu(B,a.M1),a.Gu(C,a.N1)),a.text("")),a.OC=null},a.prototype.O1=function(){var a,b,c=this;c.OG||(c.OG=!0,a=this.OC,b=a&&S(a),b&&!b.isEditing()?(c.V4||b.EF(null,b.Jl,b.Kl,null,null,!1,null),c.Q1=!0):c.Q1=!1,c.OG=!1,c.R1||c.S1())},a.prototype.rLb=function(){var a=this,b=a.qo,c=a.sLb;b.insertBefore(c,b.firstChild),c.innerText=a.oLb},a.prototype.tLb=function(a,b){if(a){var c=this.uLb;c!==b&&(this.uLb=b,a.style.display=b?"":"none")}},a.prototype.pLb=function(){var a,b=this,c=b.qo,d=b.Cia(c);d?(a=b.sLb,a||(a=b.sLb=n("span"),a.className="gcsj-func-gray-formula"),b.tLb(a,!0),b.rLb()):c.placeholder=b.oLb},a.prototype.vLb=function(){var a,b,c=this;c.oLb&&(c.oLb="",a=c.qo,b=c.Cia(a),b?c.tLb(c.sLb,!1):a.placeholder="")},a.prototype.UF=function(){var a,b,c,d,e,f,g=this,h=g.OC,i=h&&S(h);i&&(a=i.Cw,g.Q1&&a&&(b=a.text(),c=g.text(),c!==b&&(d=g.caret(),e=i.getFormulaInformation(i.getActiveRowIndex(),i.getActiveColumnIndex()),g.text(b),e.isArrayFormula&&(d>=c.length&&(d-=1),d=k(0,d-1)),g.caret(d))),(g.Q1&&a||g.V4)&&(f=i.Px,2!==f&&(i.Px=2,i.Cu(f,2))))},a.prototype.L1=function(a,b,c){var d,e,f,h,i,j="";if(a){if(d=a.parent,e=d&&d.options,f=a.getFormulaInformation(b,c),f&&f.hasFormula){if(j="="+f.formulaWithCulture,f.isDynamicArray)return this.oLb=j,"";this.oLb="",f.isArrayFormula&&(j="{"+j+"}")}else h=a.getActualStyle(b,c),i=a.getValue(b,c),j="string"==typeof i&&h.quotePrefix||j.length>0&&"="===j[0]&&e&&e.allowUserEditFormula?"'"+i:g.Ul.Il(h,i,a)||"";this.vLb()}return j},a.prototype.H1=function(a,b){var c,d,e=a.data;e.OG||(c=b.newSheet,e.V4||(e.OG=!0,e.close(),b&&(d=c,e.text(e.L1(d,d.Jl,d.Kl))),e.OG=!1))},a.prototype.E1=function(a){var b,c,d,e=a.data;e.OG||(b=e.OC,c=b&&S(b),d=c&&c.Cw,d&&e.V4===d.V4&&e.C5===d.C5&&(e.vLb(),e.OG=!0,e.text(d.text()),e.OG=!1))},a.prototype.F1=function(a,b){var c=a.data;c.V4||c.OG||(c.OG=!0,b&&c.text(c.L1(b.sheet,b.row,b.col)),c.OG=!1)},a.prototype.I1=function(a,b){var c,d,e,f,h,i=a.data;i.OG||i.V4||(i.OG=!0,b&&(c=b.sheet,d=b.row,e=b.col,f=b.rowCount,h=b.colCount,new g.Range(d,e,f,h).contains(c.Jl,c.Kl)&&i.text(i.L1(c,c.Jl,c.Kl))),i.OG=!1)},a.prototype.G1=function(a,b){var c=a.data;return c.V4&&c.D5&&c.E5?void(b.ignore=!0):void(c.OG||(c.OG=!0,c.close(),b&&b.sheet.Cw&&!b.sheet.Cw.V4&&!c.V4&&c.text(c.L1(b.sheet,b.row,b.col)),c.OG=!1))},a.prototype.qLb=function(b,c){var d=c.sheet,e=d&&d.parent&&d.parent.CF;e&&e.e2()===c.row&&e.f2()===c.col&&e.a1()===d&&b.data instanceof a&&(c.text=d.getText(c.row,c.col),b.data.J1(b,c))},a.prototype.J1=function(a,b){var c,d=a.data;d.OG||(!b.sheet.Cw||d.V4===b.sheet.Cw.V4&&d.C5===b.sheet.Cw.C5)&&(d.OG=!0,b&&(c=d.caret(),d.text(b.text),d.caret(c)),d.OG=!1)},a.prototype.K1=function(a,b){var c=a.data;c.OG||(!b.sheet.Cw||c.V4===b.sheet.Cw.V4&&c.C5===b.sheet.Cw.C5)&&(c.OG=!0,b&&c.caret(b.caret),c.OG=!1)},a.prototype.M1=function(a){var b,c,d,e,f,g,h,i,j=a.data;if(!j.OG&&(b=j.OC,c=b&&S(b))){if(c.isEditing()||(j.O1(),j.focus()),j.OG=!0,d=c.Jl,e=c.Kl,f=c.Cw,g=c.getCellType(d,e),f){if(j.V4!==f.V4||j.C5!==f.C5)return;h=f.caret(),f.text(j.text()),f.caret(h)}else i={sheet:c,row:d,col:e,sheetArea:3},g.setEditorValue(c.BF,j.text(),i);j.OG=!1}},a.prototype.N1=function(a){var b,c,d,e=a.data;e.OG||(b=e.OC,c=b&&S(b),c&&c.isEditing()&&(d=c.Cw,(!d||e.V4===d.V4&&e.C5===d.C5)&&(e.OG=!0,d&&(d.caret(e.caret()),e.S1()),e.OG=!1)))},a.prototype.ad=function(a){var b,c,d,e=this;e.T1=!1,e.U1=!1,e.MH=!1,e.W0=-1,e.i1=[],e.g1=!0,e.h1=!0,e.V1=!0,b=n("div"),b.className="gcsj-func-ac-popup",b.style.display="none",b.setAttribute(w,"gcFuncACPopup"),a.insertBefore(b,i),e.Z0=b,e.R1=!1,c=n("div"),c.className="gcsj-func-help-popup",c.style.display="none",c.setAttribute(w,"gcFuncHelpPopup"),a.insertBefore(c,i),e.$0=c,e.W1=!1,g.GC$(b).bind("mouseover",function(){e.V1=!1}).bind("mouseout",function(){e.V1=!0}),g.GC$(c).bind("mouseover",function(){e.V1=!1}).bind("mouseout",function(){e.V1=!0}),g.GC$(b).bind("scroll",function(){e.X1&&clearTimeout(e.X1),e.X1=o.setTimeout(function(){e.qo&&e.qo.focus()},100)}),d=n("div"),d.style.display="none",d.setAttribute(w,"gcFuncHelpDiv"),a.insertBefore(d,i),e._0=d,e.OC=null,e.OG=!1,e.Q1=!1,e.O0=!1},a.prototype.N0=function(a){var b,c,d;a&&(b=this,c=b.Cia(a),(b.d1(a)||c)&&(d=g.GC$(a),b.qo&&b.X0(),b.qo=a,s&&(s.msie||s.chrome)?c||t||s.chrome?(b.Fu("focus",function(){d.data(L,b.text())}),b.Fu("click",function(){d.focus()}),"input keydown keyup cut paste".split(" ").forEach(function(a){b.Fu(a,function(){b.Y1()})})):b.Fu(x,function(){b.Z1()}):b.Fu(x,function(){if(c){var a=b.qo.lastChild;s.chrome&&a&&"BR"===a.tagName&&b.qo.removeChild(a)}b.Z1()}),b.Fu("keydown",function(a){var d,e,f,h=a.ctrlKey,i=a.shiftKey,j=a.altKey,k=a.metaKey,l=h||i||j||k,m=a.keyCode;!l&&b.R1&&(m===F.down?(b._1(1),r(a)):m===F.up?(b._1(-1),r(a)):m===F.tab&&(b.a2(),r(a))),m===F.esc&&b.close(),b.b2(a),d=S(b.OC),e=d.mm.LH(a),b.V4&&e&&(f=d.Cw,f&&f.MH&&f.NH()),c&&(e?(8===m?fa(a)&&g.uHb.processBackspaceAndLeftArrowKeyEvent(a,!0):46===m&&fa(a)&&g.uHb.processDeleteAndRightArrowKeyEvent(a,!0),b.Jka()):13===m&&(h||j)?(fa(a)&&ea(),b.Jka(!0)):37===m?fa(a)&&g.uHb.processBackspaceAndLeftArrowKeyEvent(a,!1):39===m&&fa(a)&&g.uHb.processDeleteAndRightArrowKeyEvent(a,!1),c&&h&&(90===m||89===m)&&r(a))}),b.Fu("keyup",function(a){var d,e,f,g;b.b2(a),d=b.text(),c&&(e=void 0,f=a.keyCode,g=a.ctrlKey,g&&90===f?(e=b.Ac.pop()||"",b.text(e),b.Bc.push(d)):g&&89===f&&(e=b.Bc.pop(),e&&(b.text(e),b.Ac.push(d))))}),b.Fu("focus",function(a){var c=s&&s.mozilla;c&&!b.qo.innerText&&(b.qo.innerText=""),b.b2(a),b.V4&&b.D5&&(b.E5=!0,b.j5())}),b.Fu("blur",function(){b.V1&&b.close(),b.V4&&(b.H5(),b.E5=!1)}),b.Fu("mousedown",function(){b.E5=!0,b.uLb&&(b.vLb(),b.wLb=!0),b.O1()}),b.Fu("mouseup",function(){if(b.wLb){b.wLb=!1;var a=b.qo,c=o.getSelection();a!==c.anchorNode&&c.selectAllChildren(a)}b.UF()}),b.Fu("click",function(a){var c,d,e;b.MH&&b.NH(),c=b.OC,d=c&&S(c),e=d&&d.Cw,e&&e.MH&&!e.V4&&e.NH(),b.b2(a)}),b.Fu("compositionstart",function(){b.T1=!0}),b.Fu("compositionend",function(){b.T1=!1,(s.edge||s.chrome)&&b.Y1()})))},a.prototype.X0=function(){var a,b=this,c=b.qo;c&&(a=g.GC$(c),a.removeData(L),a.removeData(M),a.removeAttr(w),b.nu(),b.unbindAll(),b.V4&&(g.GC$(b.cga).empty(),b.cga=i),b.qo=i)},a.prototype.Y1=function(){var a=this,b=g.GC$(a.qo),c=a.text();b.data(L)!==c&&(a.T1||b.data(L,c),a.Z1())},a.prototype.b2=function(a){if(s&&s.msie){var b=function(a,b){return function(){a.d2(a,b)}};setTimeout(b(this,a),10)}else this.d2(this,a)},a.prototype.d2=function(a,b){var c,d,e,f,h,i=b.keyCode,j=i===F.left||i===F.right||i===F.home||i===F.end||i===F.pdn||i===F.pup||i===F.tab||i===F.enter;if(a.g1||(j=j||i===F.up||i===F.down),c=void 0!==b.button,j||c){if(d=a.qo,e=g.GC$(d),f=a.b1(d),f.start!==f.end)return;h=f.end,e.data(M)!==h&&(e.data(M,h),a.Wq(C,{}),a.S1())}},a.prototype.e2=function(){return this.OC?S(this.OC).Jl:j},a.prototype.f2=function(){return this.OC?S(this.OC).Kl:j},a.prototype.a1=function(){if(this.OC)return S(this.OC)},a.prototype.parseInternal=function(a,b,c,f){var g,h,i=this,j=[];return a&&"="===a[0]&&T(a,'"')%2!==1?(g=new d.Parser,h=e.qzb(g,a,b,c,f,!0),j=i.i2(h)):(j.push({text:a,type:17}),j)},a.prototype.T0=function(a){return this.parseInternal(a,this.a1(),this.e2(),this.f2())},a.prototype.Z1=function(){var a,b,c,d=this,e=d.text();return"\n"!==e&&e.indexOf("\n")>=0?void d.Wq(B,{type:x}):(a=d.qo,b=g.GC$(a),d.U1=!0,d.S0=d.T0(e),d.Cia(a)?d.T1||("\n"===e?(b.empty(),d.Wq(B,{type:x})):(c=d.caret(),d.V0(d.S0),d.Wq(B,{type:x}),d.caret(c))):d.Wq(B,{type:x}),c=d.caret(),b.data(M)!==c&&(b.data(M,c),d.Wq(C,{})),d.c2(),void(d.R1||d.S1()))},a.prototype.j2=function(){return f.Common.CultureManager.q4().NumberFormat},a.prototype.h2=function(){var a=this.j2();return a&&a.arrayGroupSeperator||";"},a.prototype.l2=function(){var a=this.j2();return a&&a.arrayListSeparator||","},a.prototype.w1=function(){var a=this.j2();return a&&a.listSeparator||","},a.prototype.g2=function(){var a=this.j2();return a&&a.numberDecimalSeparator||"."},a.prototype.i2=function(a){var b,c,d,e,g=[],h=[],i=this.h2(),j=this.l2(),k=!1;for(b=0;b<a.length;b++)b>0&&b<a.length-1&&";"===a[b-1].text&&","===a[b].text&&"ARRAYROW"===a[b+1].text||(c=a[b],d=this.m2(c,h),e=c.text,2===d?g.push({text:e,type:d}):k&&8===d&&","===e?g.push({text:j,type:9}):k&&8===d&&";"===e?g.push({text:i,type:10}):8===d?g.push({text:e,type:d}):3===d?("ARRAY"===e&&(k=!0),g.push({text:"{",type:3})):4===d?"ARRAY"===e?(k=!1,g.push({text:"}",type:4})):g.push({text:e,type:4}):6===d?g.push({text:")",type:d}):13===d?g.push({text:f.Common.o.nb(e),type:d,ranges:c.ranges,allowDrag:c.canDrag}):null!==d&&g.push({text:e,type:d,ranges:c.ranges,allowDrag:c.canDrag}));return g},a.prototype.m2=function(a,b){var c,d=a.type,e=a.subType,f=a.text,g=a.value;if(1===d){if(1===e)return"ARRAY"===f||"ARRAYROW"===f?(b.push(3),3):(b.push(5),"@"===g||"("===g.trim()?5:2);if(2===e){if(")"===g.trim())return 6;if(b.length>0){if(c=b[b.length-1],3===c)return b.pop(),4;if(5===c)return b.pop(),6}}if("="===g.trim())return 1}else if(3===d){if(0===e)return 8}else{if(5===d||6===d||4===d)return 7;if(0===d)return 7===e||0===e?11:5===e?12:4===e?13:3===e?14:6===e?16:14;if(7===d)return 15;if(8===d)return 17}return 17},a.prototype.z1=function(){var a,b=this,c=b.qo,d=b.S0,e="",f=d&&d.length;for(a=0;a<f;a++)e+=d[a].text;b.d1(c)?c.value=e:b.Cia(c)&&b.V0(d)},a.prototype.d1=function(a){var b=a&&a.tagName;return"TEXTAREA"===b||"INPUT"===b},a.prototype.Cia=function(a){return a&&"DIV"===a.tagName&&"true"===a.contentEditable},a.prototype.Dia=function(a){return"gcEditingInput"===g.GC$(a).attr(w)},a.prototype.bW=function(a){return a&&"="===a[0]},a.prototype.Fu=function(a,b,c){var d=this.qo;d&&a&&(a=a.split(/\s+/).join(z+" "),g.GC$(d).bind(a+z,b,c))},a.prototype.Gu=function(a,b){var c=this.qo;c&&a&&(a=a.split(/\s+/).join(z+" "),g.GC$(c).unbind(a+z,b))},a.prototype.nu=function(){var a=this.qo;a&&g.GC$(a).unbind(z)},a.prototype.Wq=function(a,b){var c=this.qo;c&&g.GC$(c).trigger(a,b)},a.prototype.s1=function(a){var b,c,d,e,f;if(a<=0)return i;if(b=this.S0,c=b&&b.length,c>0)for(d=0,e=void 0,f=0;f<c;f++)if(e=b[f],d+=e.text.length,d>=a)return e;return i},a.prototype.n2=function(){var a,b,c,d,e,f=this.OC;if(f&&(a=S(f),a&&(b=a.getCalcService().allowDynamicArray,c=a.Cw))){for(d=[].concat(c.i1),e=d.length-1;e>=0;e--)!b&&d[e]&&da(d[e].name)?d.splice(e,1):d[e].isFunc=!0;return d.concat(this.o2(f,a)).concat(this.q2(f.sheets))}return this.i1},a.prototype.o2=function(a,b){var c,d=[],e=b.getCustomNames();return e&&g.GC$.each(e,function(a,b){d.push({name:b.Cj,description:b.kT})}),c=a.getCustomNames(),c&&g.GC$.each(c,function(a,b){d.push({name:b.Cj,description:b.kT})}),d},a.prototype.q2=function(a){var b=[];return a.forEach(function(a){var c,e,f=a.tables;if(f&&(c=f.all()))for(e=0;e<c.length;e++)b.push({name:c[e].name(),description:d.sR().Fbx_TableName_Description+c[e].name()})}),b},a.prototype.s2=function(a,b){var c,d,e,f;for(a=u(a),q.Bb(a,"[")&&(a=a.substr(a.lastIndexOf("[")+1),a=q.Gb(a,"@","")),c=[],d=b&&b.length,f=0;f<d;f++)e=b[f],0===u(Z(e.name)).indexOf(a)&&c.push(e);return c},a.prototype.t2=function(){var a,b,c,d,e,f=this.caret();if(f<=0)return"";if(a=this.S0,b=a&&a.length,b>0)for(c=0,d=void 0,e=0;e<b;e++){if(d=a[e],c+d.text.length>=f)return d.text.substring(0,f-c);c+=d.text.length}return""},a.prototype.u2=function(){var a,b,c,d,e,f,g,h,j,k=this.caret(),l=this.S0,m=l&&l.length,n=[],o=0;for(b=0;b<m;b++){if(a=l[b],n.push(a),6===a.type)for(c=0;n.length>0;)if(d=n.pop(),6===d.type&&c++,5===d.type&&c--,0===c){n.length>0&&(d=n[n.length-1],d&&2===d.type&&n.pop());break}if(o+=a.text.length,o>=k)break}if(n.length>0)for(e=0;n.length>0;)if(a=n.pop(),8===a.type)e++;else if(2===a.type){for(f=u(a.text),g=this.n2(),h=g&&g.length,j=void 0,b=0;b<h;b++)if(j=g[b],u(Z(j.name))===f)return{func:j,activeParamterIndex:e,isFunc:j.isFunc};break}return i},a.prototype.c2=function(){var a,b,c,d,e,f,h,i,j=this,k=j.v2(),l=j.g1&&j.bW(j.text())&&k&&k.length>0&&!j.MH&&!j.T1;if(l&&!j.V4){for(j.w2(),a=j.Z0,k.length>8?(a.style.height="204px",a.style.overflowY="scroll"):(a.style.height="auto",a.style.overflowY=""),b="",c=k.length,d=void 0,e=0;e<c;e++)d=k[e],b+="<div class='gcsj-func-ac-row'><div class='gcsj-func-ac-row-name' isFunc="+d.isFunc+">"+Z(d.name)+"</div><div class='gcsj-func-ac-row-description'>"+(d.description||"")+"</div></div>";f=g.GC$(j.Z0),f.html(b).show(),j.R1=!0,h=f.find(".gcsj-func-ac-row"),h.length>0&&(i="gcsj-ac-row-active",g.GC$(h[0]).addClass(i),h.bind("mouseover",function(){h.removeClass(i),g.GC$(this).addClass(i)}),h.bind("click",function(){j.a2()})),j.SH()}else j.z2()},a.prototype.v2=function(){var a,b,c,e,f,g,h,i=this,j=i.s1(i.caret()),k=j&&j.text,l=[],m=i.S0.indexOf(j);if(j&&14===j.type)return l;if(a=i.A2(m),a.length>0){b=JSON.parse(JSON.stringify(d.sR().B2)),c=d.getMapping()&&d.getMapping().tableFunctionsMapping,e=[];for(f in b)g=c&&c[b[f].name],g&&(b[f].name=g),e.push(b[f]);if(l=l.concat(a).concat(e),q.jb(k,"[")||q.jb(k,"[@"))return l}else l=this.n2();return k=i.t2(),h=[],k&&(h=i.s2(k,l)),h},a.prototype.A2=function(a){var b,c,d,e,f,g,h,j,k=[],l=this.S0,m=l&&l.length;if(a<0||a>=l.length)return k;if(b=this.OC,c=b&&S(b),d={},void 0!==a&&a!==i||(a=m),c&&(e=l[a],f=c.tables,g=f&&f.findByName(q.Ib(e.text,"[")),void 0!==g&&g!==i&&!d[g])){for(d[g]=!0,h=0,j="";j!==i;)j=g.getColumnName(h),h++,j!==i&&k.push({name:j,description:""});if(k.length>0)return k}return k},a.prototype.z2=function(){g.GC$(this.Z0).hide(),this.R1=!1},a.prototype._1=function(a){var b,c,d,e,f,h,i=g.GC$(this.Z0).find(".gcsj-func-ac-row"),j=i.length;if(0!==j){if(b="gcsj-ac-row-active",c=0,a)for(d=0;d<j;d++)if(g.GC$(i[d]).hasClass(b)){c=d+a;break}e=g.GC$(this.Z0).scrollTop(),i.removeClass(b),f=0,j>0&&(f=i[0].offsetHeight),c=k(c,0),c=l(c,j-1),h=i[c],g.GC$(h).addClass(b),h.offsetTop+h.offsetHeight>g.GC$(this.Z0).scrollTop()+g.GC$(this.Z0).height()?g.GC$(this.Z0).scrollTop(g.GC$(this.Z0).scrollTop()+f):h.offsetTop<g.GC$(this.Z0).scrollTop()?g.GC$(this.Z0).scrollTop(h.offsetTop):g.GC$(this.Z0).scrollTop(e)}},a.prototype.a2=function(){var a,b,c,d,e,f,h,j,k,l,m,n,o,p,r,s=this,t=g.GC$(s.Z0).find(".gcsj-ac-row-active .gcsj-func-ac-row-name"),u=t.text(),v="true"===t.attr("isFunc");if(u){for(a=s.caret(),b=s.S0,c=b&&b.length,d=0,e=0,f=0,h=i;f<c&&(h=b[f],e=h.text.length,!(d+e>=a));)f++,d+=e;j=a-d,k=h.text,l=0,m=0,q.Bb(k,"[")?(l=k.lastIndexOf("[",j-1),l===-1?(l=k.indexOf("["),l===-1?h.text=u:h.text=u+k.substr(l),l=0):(l++,"@"===k.charAt(l)&&(l+=1),m=k.indexOf("]",j),m===-1&&(m=k.length),h.text=k.substring(0,l)+u+k.substr(m))):(h.text=u,n=k.substr(j),n&&(o=s.T0("="+n),o.length>1&&b.splice(f+1,0,o[1]))),v?h.type=2:h.type=11,p=f+1,r=b[p],!v||r&&5===r.type||b.splice(p,0,{text:"(",type:5}),s.z2(),s.qo.focus(),s.z1(),s.caret(d+u.length+l+(v?1:0)),s.S1(),s.S0=s.T0(s.text()),s.Wq(B,{})}},a.prototype.S1=function(){var a,b,c,e,f,h,j,k,m,n,o,p,q,r,s,t,u,v=this;if(v.R1&&v.z2(),a=v.u2(),a===i||a.isFunc!==!0)return void v.w2();if(b=v.w1(),c=v.h1&&v.bW(v.text())&&a&&!v.MH&&!v.T1,c&&!v.V4){for(e=a.func,f=e.parameters,h=f&&f.length,j=l(h-1,a.activeParamterIndex),k=void 0,m="",n=0;n<h;n++)k=f[n],o=k.name,k.repeatable&&(o+=b+"..."),k.optional&&(o="["+o+"]"),p=n===h-1?"":b+" ",o=n===j?"<span class='gcsj-func-help-paramter gcsj-func-help-paramter-active'>"+o+"</span>"+p:"<span class='gcsj-func-help-paramter'>"+o+"</span>"+p,m+=o;q="<div class='gcsj-func-help-title'><div class='gcsj-func-help-formula'><span class='gcsj-func-help-formula-name'>"+Z(e.name)+"</span><span class='gcsj-func-help-paramter-paren'>(</span>"+m+"<span class='gcsj-func-help-paramter-paren'>)</span></div></div>",r="<div class='gcsj-func-help-section'><div class='gcsj-func-help-section-title'>"+d.sR().Fbx_Summary+"</div><div class='gcsj-func-help-section-content'>"+(e.description||"")+"</div></div>",s="<div class='gcsj-func-help-section-content'>"+r+"</div>",t="<div class='gcsj-func-help-body'>"+s+"</div>",u=q+t,g.GC$(v.$0).html(u).show(),v.W1=!0,v.SH()}else v.w2()},a.prototype.w2=function(){g.GC$(this.$0).hide(),this.W1=!1},a.prototype.close=function(){this.z2(),this.w2()},a.prototype.BH=function(a,b){var c,d,e,f,g,h;return!this.MH&&(c=a.ctrlKey||a.shiftKey||a.altKey||a.metaKey,d=a.keyCode,e=a.ctrlKey,f=a.altKey,g=a.metaKey,h=a.srcElement||a.target,h&&b&&b.isEditing&&"gcAttachedFormulaTextBox"===h.getAttribute("gcUIElement")?67===d&&(e||g)&&!f||88===d&&(e||g)&&!f:this.R1&&!c&&(d===F.down||d===F.up||d===F.tab))},a.prototype.SH=function(){var a,b,c,d,e,f,j,k,l,m,n,o,q,r,s,t=this,u=i;if(t.R1?u=t.Z0:t.W1&&(u=t.$0),u){if(a=g.GC$(t.qo),b=g.GC$(u),c=h.G0.H0,c&&c.kj)return d=c.kj.getCellRect(c.nT,c.Mk),e=c.f1,void b.css("top",d.y+d.height+e.top).css("left",d.x+e.left);f=a.parent(),j=a.outerHeight(),t.Dia(t.qo)&&(f=f.parent(),j=f.outerHeight()),k=f.css("top"),l=parseFloat(k),isNaN(l)||(k=l),m=f.css("left"),"auto"===k&&(k=a.offset().top,m=a.offset().left),n=k+j,o=g.GC$(p.body).outerHeight(),q=b.outerHeight(),r=n+q,r>o&&(s=k-q,s>=0&&(n=s)),b.css("top",n).css("left",m)}},a.prototype.focus=function(){g.GC$(this.qo).focus()},a.prototype.V0=function(a){var b,c,d,e,f=this,g="",h="",i=a&&a.length,j=0;for(c=0;c<i;c++)b=a[c],d="",11===b.type&&(d=" style='color: "+f.o1(j)+"'",j++),f._0.innerText=b.text,g+="<span"+d+" class='gcsj-func-color-text'>"+f._0.innerHTML+"</span>",h+=b.text;if(h||f.text())if(e=f.qo,g)e.innerHTML="<span class='gcsj-func-color-content'>"+g+"</span>";else for(;e.firstChild;)e.removeChild(e.firstChild)},a.prototype.e1=function(a,b){var c,d,e,f=g.GC$(a).find(".gcsj-func-color-content .gcsj-func-color-text"),h=f.length;for(b=k(0,b),e=0;e<h;e++)if(c=f[e],d=c.innerText,b-=d.length,b<=0)return{node:c,offset:d.length+b};return d?{node:c,offset:d.length}:i},a.prototype.iIb=function(a,b){var c=o.getSelection(),d=this.qo.children[0],e=document.createRange();e.setStart(d,a),e.setEnd(d,b),c.removeAllRanges(),c.addRange(e)},a.prototype.Jka=function(a){var b=this,c=b.qo,d=b.Cia(c),e=b.text();d&&e&&(e=a?e.substr(0,e.length-2):e,b.Ac.push(e))},a.prototype.nLb=function(a,b){var c,d,e,f,g,h,i,j;if(b)for(c=0,d=0,e=0,f=b.length,g=0;g<a.length;g++){for(h=a[g].text,d;d<f;d++)if(i=b[d].toUpperCase(),j=h[e]?h[e].toUpperCase():void 0,i===j)e+=1;else{if("\n"!==i)break;d+1<f&&b[d+1]===N&&(d+=1)}a[g].text=b.substring(c,d),c=d,e=0}return a},a.prototype.mLb=function(a){var b,c,d,e,f;if("="===a[0]&&a.indexOf("\n")!==-1){for(b=[],c=a.length,d=!1,e=0;e<c;e++)f=a[e],'"'===f&&(d=!d),d?b.push(f):"\n"!==f?b.push(f):e+1<c&&a[e+1]===N&&(e+=1);return b.join("")}},a}(),b.FormulaTextBox=R;function ea(){var a,b,c,d=o.getSelection();d.rangeCount>0&&(a=d.getRangeAt(0),b=p.createElement("span"),b.innerHTML="<br/>"+N,a.insertNode(b),c=p.createRange(),c.setStartAfter(b),c.setEndAfter(b),c.collapse(!1),d.removeAllRanges(),d.addRange(c))}function fa(a){return"gcAttachedFormulaTextBox"===a.target.getAttribute("gcuielement")}},CalcEngine:function(a,b){a.exports=GC.Spread.CalcEngine},Common:function(a,b){a.exports=GC.Spread},Core:function(a,b){a.exports=GC.Spread.Sheets},SheetsCalc:function(a,b){a.exports=GC.Spread.Sheets.CalcEngine}});